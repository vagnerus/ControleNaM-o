{
  "entities": {
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a financial transaction, either an expense or income.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction."
        },
        "transactionDate": {
          "type": "string",
          "description": "The date the transaction occurred.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "The amount of the transaction."
        },
        "description": {
          "type": "string",
          "description": "A description of the transaction."
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category. (Relationship: Category 1:N Transaction)"
        },
        "subcategoryId": {
          "type": "string",
          "description": "Reference to Subcategory. (Relationship: Subcategory 1:N Transaction)"
        },
        "accountId": {
          "type": "string",
          "description": "Reference to Account. (Relationship: Account 1:N Transaction)"
        },
        "attachmentIds": {
          "type": "array",
          "description": "References to Attachments. (Relationship: Attachment 1:N Transaction)",
          "items": {
            "type": "string"
          }
        },
        "tagIds": {
          "type": "array",
          "description": "References to Tags. (Relationship: Tag N:N Transaction)",
          "items": {
            "type": "string"
          }
        },
        "isRecurring": {
          "type": "boolean",
          "description": "Indicates if the transaction is recurring."
        },
        "creditCardId": {
          "type": "string",
          "description": "Reference to CreditCard. (Relationship: CreditCard 1:N Transaction) Nullable if not related to a credit card."
        },
        "installmentId": {
          "type": "string",
          "description": "Reference to Installment. (Relationship: Installment 1:N Transaction) Nullable if not an installment."
        }
      },
      "required": [
        "id",
        "transactionDate",
        "amount",
        "description",
        "categoryId",
        "accountId"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category for classifying transactions (e.g., Food, Transportation).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the category."
        },
        "name": {
          "type": "string",
          "description": "The name of the category."
        },
        "description": {
          "type": "string",
          "description": "A description of the category."
        },
        "type": {
          "type": "string",
          "description": "The type of the category, either 'income' or 'expense'."
        }
      },
      "required": [
        "id",
        "name",
        "type"
      ]
    },
    "Subcategory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subcategory",
      "type": "object",
      "description": "Represents a subcategory for further classifying transactions within a category.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the subcategory."
        },
        "name": {
          "type": "string",
          "description": "The name of the subcategory."
        },
        "description": {
          "type": "string",
          "description": "A description of the subcategory."
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category. (Relationship: Category 1:N Subcategory)"
        }
      },
      "required": [
        "id",
        "name",
        "categoryId"
      ]
    },
    "Account": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Account",
      "type": "object",
      "description": "Represents a bank account or other financial account.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the account."
        },
        "name": {
          "type": "string",
          "description": "The name of the account."
        },
        "type": {
          "type": "string",
          "description": "The type of account (e.g., checking, savings, credit card)."
        },
        "balance": {
          "type": "number",
          "description": "The current balance of the account."
        }
      },
      "required": [
        "id",
        "name",
        "type",
        "balance"
      ]
    },
    "Attachment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Attachment",
      "type": "object",
      "description": "Represents a file attached to a transaction (e.g., a receipt).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the attachment."
        },
        "filename": {
          "type": "string",
          "description": "The name of the file."
        },
        "url": {
          "type": "string",
          "description": "The URL where the file is stored.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "filename",
        "url"
      ]
    },
    "Tag": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Tag",
      "type": "object",
      "description": "Represents a tag that can be applied to transactions for grouping and filtering.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the tag."
        },
        "name": {
          "type": "string",
          "description": "The name of the tag."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "CreditCard": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CreditCard",
      "type": "object",
      "description": "Represents a credit card account.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the credit card."
        },
        "name": {
          "type": "string",
          "description": "The name of the credit card."
        },
        "cardNumber": {
          "type": "string",
          "description": "The credit card number (masked for security)."
        },
        "closingDate": {
          "type": "number",
          "description": "The day of the month the credit card statement closes."
        },
        "dueDate": {
          "type": "number",
          "description": "The day of the month the credit card payment is due."
        },
        "limit": {
          "type": "number",
          "description": "The credit limit of the card."
        }
      },
      "required": [
        "id",
        "name",
        "cardNumber",
        "closingDate",
        "dueDate",
        "limit"
      ]
    },
    "Installment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Installment",
      "type": "object",
      "description": "Represents an installment payment for a purchase.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the installment."
        },
        "creditCardId": {
          "type": "string",
          "description": "Reference to CreditCard. (Relationship: CreditCard 1:N Installment)"
        },
        "totalInstallments": {
          "type": "number",
          "description": "The total number of installments for the purchase."
        },
        "installmentNumber": {
          "type": "number",
          "description": "The current installment number."
        },
        "amount": {
          "type": "number",
          "description": "The amount of each installment."
        }
      },
      "required": [
        "id",
        "creditCardId",
        "totalInstallments",
        "installmentNumber",
        "amount"
      ]
    },
    "Budget": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Budget",
      "type": "object",
      "description": "Represents a monthly budget for a specific category.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the budget."
        },
        "month": {
          "type": "number",
          "description": "The month the budget is for (1-12)."
        },
        "year": {
          "type": "number",
          "description": "The year the budget is for."
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category. (Relationship: Category 1:N Budget)"
        },
        "amount": {
          "type": "number",
          "description": "The budgeted amount for the category."
        }
      },
      "required": [
        "id",
        "month",
        "year",
        "categoryId",
        "amount"
      ]
    },
    "FinancialGoal": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FinancialGoal",
      "type": "object",
      "description": "Represents a financial goal (e.g., saving for a car).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the financial goal."
        },
        "name": {
          "type": "string",
          "description": "The name of the financial goal."
        },
        "targetAmount": {
          "type": "number",
          "description": "The total amount to save for the goal."
        },
        "monthlyContribution": {
          "type": "number",
          "description": "The amount to save each month."
        },
        "currentSavings": {
          "type": "number",
          "description": "The current amount saved towards the goal."
        }
      },
      "required": [
        "id",
        "name",
        "targetAmount",
        "monthlyContribution",
        "currentSavings"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/transactions/{transactionId}",
        "definition": {
          "entityName": "Transaction",
          "schema": {
            "$ref": "#/backend/entities/Transaction"
          },
          "description": "Stores financial transactions for each user. Secured by path-based ownership: only the user can access their transactions.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the transaction."
            },
            {
              "name": "transactionId",
              "description": "The ID of the transaction."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores categories for each user. Secured by path-based ownership: only the user can access their categories.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the category."
            },
            {
              "name": "categoryId",
              "description": "The ID of the category."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/subcategories/{subcategoryId}",
        "definition": {
          "entityName": "Subcategory",
          "schema": {
            "$ref": "#/backend/entities/Subcategory"
          },
          "description": "Stores subcategories for each user. Secured by path-based ownership: only the user can access their subcategories.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the subcategory."
            },
            {
              "name": "subcategoryId",
              "description": "The ID of the subcategory."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/accounts/{accountId}",
        "definition": {
          "entityName": "Account",
          "schema": {
            "$ref": "#/backend/entities/Account"
          },
          "description": "Stores accounts for each user. Secured by path-based ownership: only the user can access their accounts.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the account."
            },
            {
              "name": "accountId",
              "description": "The ID of the account."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/attachments/{attachmentId}",
        "definition": {
          "entityName": "Attachment",
          "schema": {
            "$ref": "#/backend/entities/Attachment"
          },
          "description": "Stores attachments for each user. Secured by path-based ownership: only the user can access their attachments.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the attachment."
            },
            {
              "name": "attachmentId",
              "description": "The ID of the attachment."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/tags/{tagId}",
        "definition": {
          "entityName": "Tag",
          "schema": {
            "$ref": "#/backend/entities/Tag"
          },
          "description": "Stores tags for each user. Secured by path-based ownership: only the user can access their tags.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the tag."
            },
            {
              "name": "tagId",
              "description": "The ID of the tag."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/creditCards/{creditCardId}",
        "definition": {
          "entityName": "CreditCard",
          "schema": {
            "$ref": "#/backend/entities/CreditCard"
          },
          "description": "Stores credit cards for each user. Secured by path-based ownership: only the user can access their credit cards.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the credit card."
            },
            {
              "name": "creditCardId",
              "description": "The ID of the credit card."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/installments/{installmentId}",
        "definition": {
          "entityName": "Installment",
          "schema": {
            "$ref": "#/backend/entities/Installment"
          },
          "description": "Stores installments for each user. Secured by path-based ownership: only the user can access their installments.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the installment."
            },
            {
              "name": "installmentId",
              "description": "The ID of the installment."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/budgets/{budgetId}",
        "definition": {
          "entityName": "Budget",
          "schema": {
            "$ref": "#/backend/entities/Budget"
          },
          "description": "Stores budgets for each user. Secured by path-based ownership: only the user can access their budgets.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the budget."
            },
            {
              "name": "budgetId",
              "description": "The ID of the budget."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/financialGoals/{financialGoalId}",
        "definition": {
          "entityName": "FinancialGoal",
          "schema": {
            "$ref": "#/backend/entities/FinancialGoal"
          },
          "description": "Stores financial goals for each user. Secured by path-based ownership: only the user can access their financial goals.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the financial goal."
            },
            {
              "name": "financialGoalId",
              "description": "The ID of the financial goal."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to be secure, scalable, and debuggable, adhering to the core design principles. It prioritizes Authorization Independence by denormalizing authorization data, ensures Clarity of Intent by making authorization logic explicit, and avoids custom claims by storing roles in the database (DBAC). The structure also supports secure `list` operations (QAPs) through structural segregation and membership models, and maintains data integrity through invariants. The error \"Firebase: Error (auth/operation-not-allowed)\" suggests an issue with authentication configuration, ensure sign-in methods are enabled in Firebase console. The data structure facilitates scalable and robust security rules.\n\nAuthorization Independence is achieved by avoiding hierarchical authorization dependencies. All authorization information needed to validate a request is present within the document itself, or can be derived from the path, eliminating the need for `get()` calls in security rules. This is achieved through path-based ownership and membership maps. For example, the transactions subcollection relies on path based ownership `users/{userId}/transactions/{transactionId}` so the security rules are simplified to checking `request.auth.uid == userId`.\n\nQAPs (Rules are not Filters) are supported by segregating data based on access needs and using membership models where appropriate. Path based ownership is used for private user data, meaning only the user can access their own transactions, categories, subcategories, accounts, attachments, tags, credit cards, installments, budgets, and financial goals. Thus list operations are secure and efficient."
  }
}
    